experiment:
  name: "he_to_ihc_sd_vae"
  description: "Using pretrained Stable Diffusion VAE"
  seed: 42

data:
  root_dir: /orcd/home/002/tomli/orcd/scratch/data/mist_her2/HER2_raw/HER2/TrainValAB
  image_size: 256
  batch_size: 32
  num_workers: 4
  cache_rate: 0.5
  persistent_workers: true
  prefetch_factor: 2

model:
  type: "latent_diffusion"
  
  # VAE - MATCHES SD VAE EXACTLY
  autoencoder:
    in_channels: 3
    out_channels: 3
    channels: [128, 256, 512, 512]     # SD VAE architecture
    latent_channels: 4                 # SD VAE
    num_res_blocks: 2                  # SD VAE (layers_per_block)
    sample_size: 256

  # UNet
  unet:
    in_channels: 8                     # 4 (latent) + 4 (conditioning)
    out_channels: 4
    channels: [256, 384, 512]
    num_head_channels: 64
    num_res_blocks: 2

  scheduler:
    type: "DDIM"
    num_train_timesteps: 1000
    beta_start: 0.0015
    beta_end: 0.0195
    clip_sample: false

  conditioning:
    use_classifier_free_guidance: true
    guidance_scale: 3.0
    unconditional_prob: 0.1

training:
  num_epochs: 100
  learning_rate: 0.0001
  weight_decay: 0.00001
  optimizer: "AdamW"
  
  lr_scheduler:
    type: "CosineAnnealingLR"
    T_max: 100
    eta_min: 0.000001

  loss:
    type: "MSE"
  save_interval: 10
  save_top_k: 5
  monitor: "val_loss"
  log_interval: 10
  val_interval: 5
  use_amp: true
  gradient_clip_val: 1.0

evaluation:
  metrics: ["PSNR", "SSIM"]
  num_samples: 4
  inference_steps: 50

paths:
  checkpoint_dir: "checkpoints"
  log_dir: "logs"
  output_dir: "outputs"

hardware:
  device: "cuda"
  num_gpus: 4
  distributed: false